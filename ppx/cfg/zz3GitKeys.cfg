;** GitMode keybind
KC_main = {
ENTER   , *string o,en=%*js(PPx.Result=PPx.Entry.Name;)
          *ifmatch 0,0%so"en" %: *stop
          *ifmatch status,%si"gm" %: gvim "+Gitdiff HEAD^ %R" %R %: *stop
          *ifmatch log,%si"gm" %: node %'myrepo'%\nodejs\ppx\git_getlog.js 0 %so"en" %so"en" %si"gr" %: *stop
          *ifmatch commit,%si"gm" %: gvim "+Gitdiff %*js(PPx.Result=PPx.Entry.Comment) %R" %R %: *stop
          %M_zz3gitkeys,!KC_main:enter
ESC     , *setcust XC_alac=%*getcust(_User:g_XC_alac)
          *customize C_back=%*getcust(_User:g_C_back)
          *deletecust _User:g_git_pos %: *deletecust _User:g_C_back %: *deletecust _User:g_XC_alac
          %Oi *script %'scr'%\exchangeKeys.js,0,%'cfg'%\zz3GitKeys.cfg
          *closeppx "CG,VG"
\SPACE   , *string o,id=%*midstr(%n,1)
          *ifmatch !0,0%si"gm" %: %K"@\SPACE %: *stop 0==0%*extract(C"%%NV%so"id"") %: *execute V%so"id", *jumpline 0 %%: *find "+++ %*js(PPx.Result=PPx.Entry.Name)" %: *stop
          %M_zz3gitkeys,!KC_main:\space
SPACE   , *string o,id=%*midstr(%n,1)
          *ifmatch !0,0%si"gm" %: %K"@SPACE %: *stop 0==0%*extract(C"%%NV%so"id"") %: *execute V%so"id", *jumpline 0 %%: *find "+++ %*js(PPx.Result=PPx.Entry.Name)" %: *stop
          %M_zz3gitkeys,!KC_main:space
F10     , *ifmatch !0,0%si"gm" %: *script %'scr'%\gitModePos.js %: *stop
          %M_zz3gitkeys,!KC_main:F10
F5      , *ifmatch status,%si"gm" %: node %'myrepo'%\nodejs\ppx\git_getlog.js 1 0 1 %si"gr" %: *stop
          *ifmatch log,%si"gm" %: node %'myrepo'%\nodejs\ppx\git_getlog.js 0 1 0 %si"gr" %: *stop
          %M_zz3gitkeys,!KC_main:F5
^Q      , *ifmatch !0,0%si"gm" %: *postmessage %*NT,258,81,0 %: *stop ;^@ PPbにQのキーコードを送る
          %M_zz3gitkeys,!KC_main:^Q
'\'     , *ifmatch 0,0%si"gm" %: %M_zz3gitkeys,!KC_main:'\'
J       , *execute VG,%%K"@WTOP
          *ifmatch status,%si"gm" %: %K"@DOWN %: *stop 0==0%*extract(C"%%NVG") %: *execute VG,*jumpline 0 %%: *find "+++ %*js(PPx.Result=PPx.Entry.Name)" %: *stop
          *ifmatch log,%si"gm" %: %K"@DOWN %: *stop
          *ifmatch commit,%si"gm" %: %K"@DOWN %: *stop 0==0%*extract(C"%%NVG") %: *execute VG,*jumpline 0 %%: *find "+++ %*js(PPx.Result=PPx.Entry.Name)" %: *stop
          %M_zz3gitkeys,!KC_main:J
\J      , *ifmatch !0,0%si"ppvdiff" %: *stop 0==0%*extract(C"%%NVG") %: *execute VG,%%K"@DOWN" %: *stop
          %M_zz3gitkeys,!KC_main:\J
K       , *execute VG,%%K"@WTOP
          *ifmatch status,%si"gm" %: %K"@UP %: *stop 0==0%*extract(C"%%NVG") %: *execute VG, *jumpline 0 %%: *find "+++ %*js(PPx.Result=PPx.Entry.Name)" %: *stop
          *ifmatch log,%si"gm" %: %K"@UP %: *stop
          *ifmatch commit,%si"gm" %: %K"@UP %: *stop 0==0%*extract(C"%%NVG") %: *execute VG,*jumpline 0 %%: *find "+++ %*js(PPx.Result=PPx.Entry.Name)" %: *stop
          %M_zz3gitkeys,!KC_main:K
\K      , *ifmatch !0,0%si"ppvdiff" %: *stop 0==0%*extract(C"%%NVG") %: *execute VG,%%K"@UP" %: *stop
          %M_zz3gitkeys,!KC_main:\K
^L      , *ifmatch !0,0%si"gm" %: *string i,gm=log %: *jumppath %*regexp("%si"pl"","s/_commit//") %: *viewstyle -temp gitlog %: *stop
          %M_zz3gitkeys,!KC_main:^L
Q       , *ifmatch !0,0%si"gm" %: *stop 0==0%*extract(C"%%NVG") %: *string i,ppvdiff= %: *closeppx VG %: *stop
          %M_zz3gitkeys,!KC_main:Q
^S      , *ifmatch !0,0%si"gm" %: *string i,gm=status %: *jumppath %si"ps" %: *string i,pd=%*regexp("%si"pd"","s/_commit//") %: *viewstyle -temp gitstatus %: *stop
          %M_zz3gitkeys,!KC_main:^S
Y       , *setcust X_vpos=0
          *string o,en=%*js(PPx.Result=PPx.Entry.Name;)
          *ifmatch status,%si"gm" %: *if 0==0%si"ppvdiff" %: *string i,ppvdiff=1 %: *ppv -r -esc:on -bootid:G %si"pd" -k *jumpline 0 %%: *find "+++ %so"en"" %%: *focus CG %: *stop
          *ifmatch status,%si"gm" %: *string i,ppvdiff= %: *closeppx VG %: *stop
          *ifmatch log,%si"gm" %: *postmessage %*NT,258,81,0 %: git log -n1 --stat --color %so"en" %: *stop
          *ifmatch commit,%si"gm" %: *if 0==0%si"ppvdiff" %: *string i,ppvdiff=1 %: *ppv -r -esc:on -bootid:G %si"pd" -k *jumpline 0 %%: *find "+++ %so"en"" %%: *focus CG %: *stop
          *ifmatch commit,%si"gm" %: *string i,ppvdiff= %: *closeppx VG %: *stop
}

KV_main = {
FIRSTEVENT  , *customize XV_drag=0,1,3,2
              *setcust MV_click:L_SPC=@^ENTER
              *setcust @%'cfg'%\zz2HMppvDoc.cfg
              *script %'scr'%\movingPPv.js
LOADEVENT   =
ACTIVEEVENT =
TAB         , *ifmatch !0,0%*extract(CG"%%si""gm""") %: *focus CG %: *stop
              %M_zz3gitkeys,!KV_main:TAB
^TAB        , *focus C
ESC         , *setcust X_vpos=0
              *ifmatch !0,0%*extract(CG,%si"gm") %: %*execute CG,*string i,ppvdiff=
              %K"@Q"
Q           , *ifmatch !0,0%*extract(CG,%si"gm") %: %*execute CG,*string i,ppvdiff=
              %K"@Q"
Y           , *setcust X_vpos=0
              *ifmatch !0,0%*extract(CG,%si"gm") %: %*execute CG,*string i,ppvdiff=
              %K"@Q"
}

KB_edit = {
ESC , %Oi *script %'scr'%\exchangeKeys.js,0,%'cfg'%\zz3GitKeys.cfg
      *setcust XC_alac=1
      *customize C_back=%*getcust(_User:u_tempBg)
      *deletecust _User:g_git_pos %: *deletecust _User:g_C_back %: *deletecust _User:g_XC_alac
      *closeppx "CG,VG,B*"
}
